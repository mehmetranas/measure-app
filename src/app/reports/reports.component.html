<div class="container-fluid">
  <div class="row">
    <div class="col-md-3">
      <mat-card class="app-brief app-brief-daily mat-elevation-z3" (click)="getEndOfDayOrders()" [class.highlight] = "selectedCard === 'endOfDay'">
        <mat-card-title class="text-center">Günlük</mat-card-title>
        <mat-card-content>
          <ng-container *ngIf="endOfDayBrief;else alertMessage">
          <div class="container" fxLayout="row" fxLayoutAlign="space-between center">
            <div>
              <mat-icon>view_list</mat-icon>
            </div>
            <div fxLayout="column" fxLayoutAlign="center center">
              <div>
                <h5>{{ endOfDayBrief.count }}&nbsp;Adet</h5>
              </div>
              <div>
                <h4>{{ endOfDayBrief.sum | currency:"TRY":"symbol-narrow":"1.0-0":"tr" }}</h4>
              </div>
            </div>
          </div>
          </ng-container>
        </mat-card-content>
      </mat-card>
    </div>
    <div class="col-md-3">
      <mat-card class="app-brief app-brief-report mat-elevation-z3" (click)="getDetail('lastMonth')" [class.highlight] = "selectedCard === 'lastMonth'">
        <mat-card-title class="text-center">Aylık</mat-card-title>
        <mat-card-content>
          <ng-container *ngIf="lastMonthBrief;else alertMessage">
            <div class="container" fxLayout="row" fxLayoutAlign="space-between center">
              <div>
                <mat-icon>trending_up</mat-icon>
              </div>
              <div fxLayout="column" fxLayoutAlign="center center">
                <div>
                  <h5>{{ lastMonthBrief.count }}&nbsp;Adet</h5>
                </div>
                <div>
                  <h4>{{ lastMonthBrief.sum | currency:"TRY":"symbol-narrow":"1.0-0":"tr" }}</h4>
                </div>
              </div>
            </div>
          </ng-container>
        </mat-card-content>
      </mat-card>
    </div>
    <div class="col-md-3">
        <mat-card class="app-brief app-brief-report mat-elevation-z3" (click)="getDetail('last3Months')" [class.highlight] = "selectedCard === 'last3Months'">
          <mat-card-title class="text-center">3 Aylık</mat-card-title>
          <mat-card-content>
            <ng-container *ngIf="last3MonthsBrief;else alertMessage">
              <div class="container" fxLayout="row" fxLayoutAlign="space-between center">
                <div>
                  <mat-icon>trending_up</mat-icon>
                </div>
                <div fxLayout="column" fxLayoutAlign="center center">
                  <div>
                    <h5>{{ last3MonthsBrief.count }}&nbsp;Adet</h5>
                  </div>
                  <div>
                    <h4>{{ last3MonthsBrief.sum | currency:"TRY":"symbol-narrow":"1.0-0":"tr" }}</h4>
                  </div>
                </div>
              </div>
            </ng-container>
          </mat-card-content>
        </mat-card>
    </div>
    <div class="col-md-3">
      <mat-card class="app-brief app-brief-report mat-elevation-z3" (click)="getDetail('lastYear')" [class.highlight] = "selectedCard === 'lastYear'">
        <mat-card-title class="text-center">Yıllık</mat-card-title>
        <mat-card-content>
          <ng-container *ngIf="lastYearBrief;else alertMessage">
            <div class="container" fxLayout="row" fxLayoutAlign="space-between center">
              <div>
                <mat-icon>trending_up</mat-icon>
              </div>
              <div fxLayout="column" fxLayoutAlign="center center">
                <div>
                  <h5>{{ lastYearBrief.count }}&nbsp;Adet</h5>
                </div>
                <div>
                  <h4>{{ lastYearBrief.sum | currency:"TRY":"symbol-narrow":"1.0-0":"tr" }}</h4>
                </div>
              </div>
            </div>
          </ng-container>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
  <hr>
  <ng-container [ngSwitch]="tab">
    <div class="app-detail-page">

      <div class="row" *ngSwitchCase="'report'">
        <div class="col-md-6">
          <mat-card class="app-detail-card mat-elevation-z4">
            <mat-card-title class="text-center">Grafik</mat-card-title>
            <mat-card-content>
              <app-chart #chart [title]="title" [reports]="reports" [labelType]="labelType"></app-chart>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="col-md-6">
          <mat-card class="app-detail-card mat-elevation-z4">
            <mat-card-title class="text-center">Tablo</mat-card-title>
            <mat-card-subtitle class="text-center">{{ title }}&nbsp;Özet Tablosu</mat-card-subtitle>
            <mat-card-content>
              <div class="col-md-12">
                <table class="table table-striped table-sm">
                  <thead>
                  <tr>
                    <th>#</th>
                    <th>Adet</th>
                    <th>Tutar - TL</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let report of reports">
                    <ng-container *ngIf="labelType === 'week';else monthDate">
                      <td>{{ report[labelType] }}</td>
                    </ng-container>
                    <ng-template #monthDate>
                      <td>{{ report.date | date: "MMM":"":"tr" }}</td>
                    </ng-template>
                    <td>{{ report.count }}</td>
                    <td>{{ report.sum | currency: 'TRY':"symbol-narrow":"1.0-0":"tr" }}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div class="row" *ngSwitchCase="'endOfDay'">
        <div class="col-md-12">
          <mat-card class="mat-elevation-z4">
            <mat-card-subtitle>
              Bugün Siparişleri
            </mat-card-subtitle>
            <mat-card-content>
              <div class="table-container mat-elevation-z3">
                <ng-container *ngIf="isPending;else appDataTable">
                  <div style="height: 25vh;" fxLayout="row" fxLayoutAlign="center center">
                    <mat-spinner [diameter]="35"></mat-spinner>
                  </div>
                </ng-container>
                <ng-template #appDataTable>
                  <mat-table [dataSource]="dataSource">
                    <ng-container matColumnDef="name">
                      <mat-header-cell *matHeaderCellDef> Müşteri İsmi</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{order.customer.nameSurname}}</mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="username">
                      <mat-header-cell *matHeaderCellDef> Ölçü Alan</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{order.userUsername}}</mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="deliveryDate">
                      <mat-header-cell *matHeaderCellDef> Teslim Tarihi</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{order?.deliveryDate | date:"MMM d":"":"tr"}}</mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="state">
                      <mat-header-cell *matHeaderCellDef> Durum</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{(order.orderStatus | orderStatus).viewValue}}</mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="total">
                      <mat-header-cell *matHeaderCellDef> Toplam</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{order.totalAmount | currency:"TRY":"symbol-narrow":"1.0-0":"tr"}}
                      </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="deposite">
                      <mat-header-cell *matHeaderCellDef> Ödenen</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{order.depositeAmount |
                        currency:"TRY":"symbol-narrow":"1.0-0":"tr"}}
                      </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="remain">
                      <mat-header-cell *matHeaderCellDef> Kalan</mat-header-cell>
                      <mat-cell *matCellDef="let order"> {{ order.totalAmount - order.depositeAmount |
                        currency:"TRY":"symbol-narrow":"1.0-0":"tr"}}
                      </mat-cell>
                    </ng-container>
                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                  </mat-table>
                </ng-template>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
      <div class="alert alert-warning text-center" *ngSwitchDefault role="alert">
        Grafik ve Tablo Detayı için &nbsp;<span class="text-danger font-italic">bir kart seçiniz</span>
      </div>

    </div>
  </ng-container>
</div>
<ng-template #alertMessage>
  <div class="alert alert-info" role="alert" fxLayout="row" fxLayoutAlign="space-around center ">
    <div>Gösterilecek bilgi bulunmuyor</div>
    <div><mat-icon class="app-alert">error_outline</mat-icon></div>
  </div>
</ng-template>
